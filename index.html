<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Anonim Dert Paylaş</title>
  <style>
    body { font-family: Arial; padding: 20px; background: #f0f0f0; }
    .form-container, .dert { background: white; padding: 15px; border-radius: 10px; margin-bottom: 20px; }
    input, textarea, button { width: 100%; margin-top: 10px; padding: 10px; font-size: 1em; }
    button { background: #6c63ff; color: white; border: none; border-radius: 5px; cursor: pointer; }
    button:hover { background: #574fd6; }
    .yorumlar { margin-top: 10px; border-top: 1px solid #ddd; padding-top: 10px; }
    .yorum { background: #f9f9f9; padding: 5px; margin-top: 5px; border-radius: 5px; }
  </style>
</head>
<body>

<h1>Anonim Dert Paylaş</h1>

<div class="form-container">
  <input type="text" id="baslik" placeholder="Yorum Başlığı">
  <textarea id="icerik" rows="4" placeholder="Yorumunuzu yazın..."></textarea>
  <button onclick="dertEkle()">Paylaş</button>
</div>

<div id="dertListesi"></div>

<script>
  // Sayfa yüklendiğinde dertleri getir
  window.onload = function() {
    verileriGetir();
  };

  async function verileriGetir() {
    try {
      const response = await fetch('api.php?action=get_dertler');
      const dertler = await response.json();
      guncelle(dertler);
    } catch (error) {
      console.error('Hata:', error);
    }
  }

  async function dertEkle() {
    const baslik = document.getElementById("baslik").value.trim();
    const icerik = document.getElementById("icerik").value.trim();

    if (!baslik || !icerik) {
      alert("Lütfen başlık ve içerik giriniz.");
      return;
    }

    try {
      const response = await fetch('api.php', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          action: 'add_dert',
          baslik: baslik,
          icerik: icerik
        })
      });
      
      const result = await response.json();
      if (result.success) {
        verileriGetir();
        temizle();
      }
    } catch (error) {
      console.error('Hata:', error);
    }
  }

  async function yorumEkle(dertId, index) {
    const yorumInput = document.getElementById(`yorumInput-${index}`);
    const yorum = yorumInput.value.trim();

    if (!yorum) return;

    try {
      const response = await fetch('api.php', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          action: 'add_yorum',
          dert_id: dertId,
          yorum: yorum
        })
      });
      
      const result = await response.json();
      if (result.success) {
        verileriGetir();
        yorumInput.value = "";
      }
    } catch (error) {
      console.error('Hata:', error);
    }
  }

  function guncelle(dertler) {
    const liste = document.getElementById("dertListesi");
    liste.innerHTML = "";

    dertler.forEach((dert, index) => {
      const div = document.createElement("div");
      div.className = "dert";
      div.innerHTML = `
        <h3>${dert.baslik}</h3>
        <p>${dert.icerik}</p>
        <div class="yorumlar">
          <strong>Yorumlar:</strong>
          ${dert.yorumlar ? dert.yorumlar.map(y => `<div class="yorum">${y.yorum}</div>`).join("") : ''}
          <input id="yorumInput-${index}" placeholder="Yorum yaz...">
          <button onclick="yorumEkle(${dert.id}, ${index})">Ekle</button>
        </div>
      `;
      liste.appendChild(div);
    });
  }

  function temizle() {
    document.getElementById("baslik").value = "";
    document.getElementById("icerik").value = "";
  }
</script>

</body>
</html>
